{% load static %}
{% load auth_extras %}

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Alltech Contratos{% endblock %}</title>
    <link rel="icon" href="{% static 'img/logo_alltech_branco2.png' %}">

    <!-- Flowbite e Font Awesome -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <!-- Configuração do Tailwind CSS -->
    <script>
        tailwind.config = {
            darkMode: 'class', // Habilita o dark mode baseado em classe
            theme: {
                extend: {
                    colors: {
                        primary: {"50":"#eff6ff","100":"#dbeafe","200":"#bfdbfe","300":"#93c5fd","400":"#60a5fa","500":"#3b82f6","600":"#2563eb","700":"#1d4ed8","800":"#1e40af","900":"#1e3a8a","950":"#172554"}
                    }
                }
            }
        }
    </script>

    <style>
        /* Estilos para transições suaves */
        #default-sidebar, main {
            transition: all 0.3s ease-in-out;
        }

        /* Quando a sidebar está minimizada */
        body.sidebar-minimized #default-sidebar {
            width: 80px; /* Largura apenas para os ícones */
        }

        body.sidebar-minimized main {
            margin-left: 80px;
        }

        body.sidebar-minimized .nav-text, 
        body.sidebar-minimized #logo-container span {
            display: none; /* Esconde o texto dos links e da logo */
        }

        body.sidebar-minimized #logo-container {
            justify-content: center;
        }

        body.sidebar-minimized #default-sidebar ul a {
            justify-content: center; /* Centraliza os ícones */
        }

        /* Ajustes para submenus quando minimizado */
        body.sidebar-minimized #default-sidebar ul ul {
            padding-left: 0 !important; /* Remove padding esquerdo dos submenus */
            padding-right: 0 !important;
            margin-left: 0 !important;
            margin-right: 0 !important;
        }

        body.sidebar-minimized #default-sidebar ul ul li {
            width: 100%;
            display: flex;
            justify-content: center;
        }

        body.sidebar-minimized #default-sidebar ul ul li a {
            padding-left: 0 !important; /* Remove padding esquerdo dos links dos submenus */
            padding-right: 0 !important;
            padding-top: 0.5rem !important;
            padding-bottom: 0.5rem !important;
            justify-content: center !important; /* Centraliza os ícones */
            width: 100%;
            min-width: 0;
            margin: 0 auto;
        }

        body.sidebar-minimized #default-sidebar ul ul li a i {
            margin-right: 0 !important; /* Remove margem direita do ícone */
            margin-left: 0 !important;
            font-size: 1rem !important; /* Tamanho padrão do ícone */
            display: block;
            text-align: center;
        }

        /* Remove espaçamento do texto nos submenus quando minimizado */
        body.sidebar-minimized #default-sidebar ul ul li a span {
            display: none;
        }

        /* Esconde setas de dropdown quando minimizado */
        body.sidebar-minimized #default-sidebar button svg {
            display: none;
        }

        /* Ajusta botões de menu principal quando minimizado */
        body.sidebar-minimized #default-sidebar button {
            justify-content: center !important;
            padding-left: 0.75rem !important;
            padding-right: 0.75rem !important;
        }

        /* Esconde separadores de seção quando minimizado */
        body.sidebar-minimized #default-sidebar li.pt-4 {
            display: none;
        }

        /* Garante que o sidebar não tenha overflow quando minimizado */
        body.sidebar-minimized #default-sidebar {
            overflow-x: hidden;
        }

        body.sidebar-minimized #default-sidebar > div {
            padding-left: 0.5rem !important;
            padding-right: 0.5rem !important;
        }
    </style>

    <script>
        // Script para aplicar tema escuro/claro imediatamente para evitar "flash" e persistir mudança
        if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>

</head>
<body class="bg-gray-100 dark:bg-gray-900">

<!-- Botão Hamburguer (agora fora do sidebar para controle) -->
<button id="hamburger-button" type="button" class="fixed top-4 z-50 left-4 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-white focus:outline-none">
    <svg class="w-10 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
</button>

<!-- Sidebar -->
<aside id="default-sidebar" class="fixed top-0 left-0 z-40 w-64 h-screen bg-white dark:bg-gray-800 shadow-lg">
    <div class="h-full px-3 py-4 overflow-y-auto">
        <!-- Logo -->
        <div id="logo-container" class="flex items-center ps-2.5 mb-5 h-12">
            <img src="{% static 'img/logo_alltech_branco2.png' %}" class="h-7 me-3" alt="Alltech Logo" />
            <span class="self-center text-xl font-semibold text-gray-500 whitespace-nowrap dark:text-white">AllTech</span>
        </div>

        <ul class="space-y-1 font-medium">
            <!-- Dashboard -->
            <li>
                <a href="{% url 'dashboard' %}" class="flex items-center p-3 rounded-xl text-gray-700 dark:text-gray-200 hover:bg-gradient-to-r hover:from-blue-500 hover:to-blue-600 hover:text-white dark:hover:text-white transition-all duration-300 group">
                    <div class="w-9 h-9 flex items-center justify-center rounded-lg bg-gradient-to-br from-blue-500 to-blue-600 text-white shadow-lg shadow-blue-500/30">
                        <i class="fas fa-tachometer-alt"></i>
                    </div>
                    <span class="ms-3 nav-text font-semibold">Dashboard</span>
                </a>
            </li>
            
            <!-- Separador com título -->
            <li class="pt-4 pb-2">
                <p class="px-3 text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider nav-text">Gestão de Clientes</p>
            </li>
            
            <!-- Gestão de Clientes -->
            <li>
                <button type="button" class="flex items-center w-full p-3 rounded-xl text-gray-700 dark:text-gray-200 hover:bg-gradient-to-r hover:from-emerald-500 hover:to-teal-500 hover:text-white dark:hover:text-white transition-all duration-300 group" data-collapse-toggle="gestao-clientes">
                    <div class="w-9 h-9 flex items-center justify-center rounded-lg bg-gradient-to-br from-emerald-500 to-teal-500 text-white shadow-lg shadow-emerald-500/30">
                        <i class="fas fa-users"></i>
                    </div>
                    <span class="ms-3 nav-text font-semibold flex-1 text-left">Clientes</span>
                    <svg class="w-4 h-4 ms-auto transition-transform duration-300 nav-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
                <ul id="gestao-clientes" class="hidden py-2 space-y-1 ps-4">
                    <li>
                        <a href="{% url 'cliente_list' %}" class="flex items-center p-2 ps-12 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 hover:text-emerald-600 dark:hover:text-emerald-400 transition-all duration-200 group">
                            <i class="fas fa-building fa-fw text-emerald-500 text-sm"></i>
                            <span class="ms-3 nav-text text-sm">Clientes</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'customer_success_list' %}" class="flex items-center p-2 ps-12 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-emerald-50 dark:hover:bg-emerald-900/20 hover:text-emerald-600 dark:hover:text-emerald-400 transition-all duration-200 group">
                            <i class="fas fa-comments fa-fw text-emerald-500 text-sm"></i>
                            <span class="ms-3 nav-text text-sm">Customer Success</span>
                        </a>
                    </li>
                </ul>
            </li>
            
            <!-- Separador com título -->
            <li class="pt-4 pb-2">
                <p class="px-3 text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider nav-text">Gestão de Contratos</p>
            </li>
            
            <!-- Gestão de Contratos -->
            <li>
                <button type="button" class="flex items-center w-full p-3 rounded-xl text-gray-700 dark:text-gray-200 hover:bg-gradient-to-r hover:from-violet-500 hover:to-purple-600 hover:text-white dark:hover:text-white transition-all duration-300 group" data-collapse-toggle="gestao-contratos">
                    <div class="w-9 h-9 flex items-center justify-center rounded-lg bg-gradient-to-br from-violet-500 to-purple-600 text-white shadow-lg shadow-violet-500/30">
                        <i class="fas fa-file-contract"></i>
                    </div>
                    <span class="ms-3 nav-text font-semibold flex-1 text-left">Contratos</span>
                    <svg class="w-4 h-4 ms-auto transition-transform duration-300 nav-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
                <ul id="gestao-contratos" class="hidden py-2 space-y-1 ps-4">
                    <li>
                        <a href="{% url 'gestao_contratos_list' %}" class="flex items-center p-2 ps-12 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-violet-50 dark:hover:bg-violet-900/20 hover:text-violet-600 dark:hover:text-violet-400 transition-all duration-200 group">
                            <i class="fas fa-file-signature fa-fw text-violet-500 text-sm"></i>
                            <span class="ms-3 nav-text text-sm">Contratos</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'item_fornecedor_list' %}" class="flex items-center p-2 ps-12 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-violet-50 dark:hover:bg-violet-900/20 hover:text-violet-600 dark:hover:text-violet-400 transition-all duration-200 group">
                            <i class="fas fa-box-open fa-fw text-violet-500 text-sm"></i>
                            <span class="ms-3 nav-text text-sm">Itens de Fornecedor</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'ordem_fornecimento_list' %}" class="flex items-center p-2 ps-12 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-violet-50 dark:hover:bg-violet-900/20 hover:text-violet-600 dark:hover:text-violet-400 transition-all duration-200 group">
                            <i class="fas fa-truck-loading fa-fw text-violet-500 text-sm"></i>
                            <span class="ms-3 nav-text text-sm">Ordens de Fornecimento</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'sla_list' %}" class="flex items-center p-2 ps-12 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-violet-50 dark:hover:bg-violet-900/20 hover:text-violet-600 dark:hover:text-violet-400 transition-all duration-200 group">
                            <i class="fas fa-clipboard-check fa-fw text-violet-500 text-sm"></i>
                            <span class="ms-3 nav-text text-sm">SLAs</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'fila_faturamento' %}" class="flex items-center p-2 ps-12 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-violet-50 dark:hover:bg-violet-900/20 hover:text-violet-600 dark:hover:text-violet-400 transition-all duration-200 group">
                            <i class="fas fa-receipt fa-fw text-violet-500 text-sm"></i>
                            <span class="ms-3 nav-text text-sm">Fila de Faturamento</span>
                </a>
            </li>
            <li>
                        <a href="{% url 'documento_contrato_list' %}" class="flex items-center p-2 ps-12 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-violet-50 dark:hover:bg-violet-900/20 hover:text-violet-600 dark:hover:text-violet-400 transition-all duration-200 group">
                            <i class="fas fa-robot fa-fw text-violet-500 text-sm"></i>
                            <span class="ms-3 nav-text text-sm">Análise com IA</span>
                        </a>
                    </li>
                </ul>
            </li>
            
            <!-- Separador com título -->
            <li class="pt-4 pb-2">
                <p class="px-3 text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider nav-text">Gestão de Projetos</p>
            </li>
            
            <!-- Gestão de Projetos -->
            <li>
                <button type="button" class="flex items-center w-full p-3 rounded-xl text-gray-700 dark:text-gray-200 hover:bg-gradient-to-r hover:from-amber-500 hover:to-orange-500 hover:text-white dark:hover:text-white transition-all duration-300 group" data-collapse-toggle="gestao-projetos">
                    <div class="w-9 h-9 flex items-center justify-center rounded-lg bg-gradient-to-br from-amber-500 to-orange-500 text-white shadow-lg shadow-amber-500/30">
                        <i class="fas fa-project-diagram"></i>
                    </div>
                    <span class="ms-3 nav-text font-semibold flex-1 text-left">Projetos</span>
                    <svg class="w-4 h-4 ms-auto transition-transform duration-300 nav-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
                <ul id="gestao-projetos" class="hidden py-2 space-y-1 ps-4">
                    <li>
                        <a href="{% url 'projeto_list' %}" class="flex items-center p-2 ps-12 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-amber-50 dark:hover:bg-amber-900/20 hover:text-amber-600 dark:hover:text-amber-400 transition-all duration-200 group">
                            <i class="fas fa-folder-open fa-fw text-amber-500 text-sm"></i>
                            <span class="ms-3 nav-text text-sm">Projetos</span>
                </a>
            </li>
            <li>
                        <a href="{% url 'ordem_servico_list' %}" class="flex items-center p-2 ps-12 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-amber-50 dark:hover:bg-amber-900/20 hover:text-amber-600 dark:hover:text-amber-400 transition-all duration-200 group">
                            <i class="fas fa-tools fa-fw text-amber-500 text-sm"></i>
                            <span class="ms-3 nav-text text-sm">Ordens de Serviço</span>
                </a>
            </li>
            <li>
                        <a href="{% url 'timesheet_list' %}" class="flex items-center p-2 ps-12 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-amber-50 dark:hover:bg-amber-900/20 hover:text-amber-600 dark:hover:text-amber-400 transition-all duration-200 group">
                            <i class="fas fa-clock fa-fw text-amber-500 text-sm"></i>
                            <span class="ms-3 nav-text text-sm">Timesheet</span>
                        </a>
                    </li>
                </ul>
            </li>
            
            <!-- Separador com título - Administração (apenas para Admin) -->
            {% if user|is_in_group:"Admin" %}
            <li class="pt-4 pb-2">
                <p class="px-3 text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider nav-text">Administração</p>
            </li>
            
            <!-- Administração -->
            <li>
                <button type="button" class="flex items-center w-full p-3 rounded-xl text-gray-700 dark:text-gray-200 hover:bg-gradient-to-r hover:from-red-500 hover:to-pink-600 hover:text-white dark:hover:text-white transition-all duration-300 group" data-collapse-toggle="administracao">
                    <div class="w-9 h-9 flex items-center justify-center rounded-lg bg-gradient-to-br from-red-500 to-pink-600 text-white shadow-lg shadow-red-500/30">
                        <i class="fas fa-cog"></i>
                    </div>
                    <span class="ms-3 nav-text font-semibold flex-1 text-left">Administração</span>
                    <svg class="w-4 h-4 ms-auto transition-transform duration-300 nav-text" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                    </svg>
                </button>
                <ul id="administracao" class="hidden py-2 space-y-1 ps-4">
                    <li>
                        <a href="{% url 'colaborador_list' %}" class="flex items-center p-2 ps-12 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-50 dark:hover:bg-red-900/20 hover:text-red-600 dark:hover:text-red-400 transition-all duration-200 group">
                            <i class="fas fa-user-tie fa-fw text-red-500 text-sm"></i>
                            <span class="ms-3 nav-text text-sm">Colaboradores</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'grupo_list' %}" class="flex items-center p-2 ps-12 rounded-lg text-gray-600 dark:text-gray-300 hover:bg-red-50 dark:hover:bg-red-900/20 hover:text-red-600 dark:hover:text-red-400 transition-all duration-200 group">
                            <i class="fas fa-users-cog fa-fw text-red-500 text-sm"></i>
                            <span class="ms-3 nav-text text-sm">Grupos</span>
                        </a>
                    </li>
                </ul>
            </li>
            {% endif %}
        </ul>
    </div>
</aside>

<!-- Conteúdo Principal -->
<main id="main-content" class="p-4 ml-64">
    <div class="mt-14"> <!-- Margem no topo para não ficar atrás dos botões fixos -->
        {% block content %}
        <!-- O conteúdo específico de cada página será inserido aqui -->
        {% endblock %}
    </div>
</main>

<!-- Botões de Ação no Canto Superior Direito -->
<div class="fixed top-4 right-4 z-50 flex items-center space-x-4">

    <!-- Botão Dark/Light Mode -->
    <button id="theme-toggle" type="button" class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 me-4">
        <i id="theme-toggle-dark-icon" class="hidden fa-solid fa-moon fa-lg"></i>
        <i id="theme-toggle-light-icon" class="hidden fa-solid fa-sun fa-lg"></i>
    </button>

    <!-- Menu do Usuário -->
    <div>
        <button type="button" class="flex text-sm bg-gray-800 rounded-full focus:ring-4 focus:ring-gray-300 dark:focus:ring-gray-600" id="user-menu-button" aria-expanded="false" data-dropdown-toggle="user-dropdown" data-dropdown-placement="bottom">
            <span class="sr-only">Open user menu</span>
            <img class="w-8 h-8 rounded-full" src="https://ui-avatars.com/api/?name={{ user.get_full_name|default:'User' }}&background=0D8ABC&color=fff" alt="user photo">
         </button>
        <!-- Dropdown menu -->
        <div class="z-50 hidden my-4 text-base list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700 dark:divide-gray-600" id="user-dropdown">
            <div class="px-4 py-3">
                <span class="block text-sm text-gray-900 dark:text-white">{{ user.get_full_name|default:'Usuário' }}</span>
                <span class="block text-sm text-gray-500 truncate dark:text-gray-400">{{ user.email|default:'email@example.com' }}</span>
            </div>
            <ul class="py-2" aria-labelledby="user-menu-button">
                <li>
                    <a href="#" id="logout-btn" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white">Sair</a>
                </li>
            </ul>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    
    // --- LÓGICA DO TEMA (LIGHT/DARK MODE) ---
    const themeToggleButton = document.getElementById('theme-toggle');
    const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
    const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');

    // Função para atualizar os ícones de tema
    function updateThemeIcons() {
        if (document.documentElement.classList.contains('dark')) {
            themeToggleLightIcon.classList.remove('hidden');
            themeToggleDarkIcon.classList.add('hidden');
        } else {
            themeToggleLightIcon.classList.add('hidden');
            themeToggleDarkIcon.classList.remove('hidden');
        }
    }
    // Inicializa os ícones no carregamento da página
    updateThemeIcons();

    // Lógica do Toggle de Tema (Dark/Light)
    themeToggleButton.addEventListener('click', () => {
        const isDark = document.documentElement.classList.toggle('dark');
        localStorage.setItem('color-theme', isDark ? 'dark' : 'light');
        updateThemeIcons();
    });

    // --- LÓGICA DO LOGOUT ---
    const logoutBtn = document.getElementById('logout-btn');
    if (logoutBtn) {
        logoutBtn.addEventListener('click', function(e) {
            e.preventDefault();
            // Idealmente, aqui você faria um POST para uma URL de logout
            // Para simplicidade, estamos apenas redirecionando.
            alert('Você será deslogado.');
            window.location.href = '/logout/'; // Adapte esta URL se necessário
        });
    }

    // --- LÓGICA DA SIDEBAR (MINIMIZAR/MAXIMIZAR) ---
    const hamburgerButton = document.getElementById('hamburger-button');
    const body = document.body;
    const mainContent = document.getElementById('main-content');
    const sidebar = document.getElementById('default-sidebar');

    // Função para aplicar o estado salvo da sidebar
    function applySidebarState() {
        if (localStorage.getItem('sidebarState') === 'minimized') {
            body.classList.add('sidebar-minimized');
            mainContent.style.marginLeft = '80px';
            hamburgerButton.style.left = '80px'; 
        } else {
            body.classList.remove('sidebar-minimized');
            mainContent.style.marginLeft = '256px'; // w-64
            hamburgerButton.style.left = '256px';
        }
    }

    // Aplica o estado ao carregar a página
    applySidebarState();
    // Move o botão hamburguer para a posição correta, que depende do estado da sidebar
    // A posição do botão hamburguer é relativa a sidebar
    hamburgerButton.style.left = body.classList.contains('sidebar-minimized') ? '80px' : '256px';

    hamburgerButton.addEventListener('click', function() {
        body.classList.toggle('sidebar-minimized');
        
        // Salva o novo estado no localStorage
        if (body.classList.contains('sidebar-minimized')) {
            localStorage.setItem('sidebarState', 'minimized');
        } else {
            localStorage.setItem('sidebarState', 'expanded');
        }
        
        // Reaplica o estado para ajustar margens e posições
        applySidebarState();
    });
});
</script>


<!-- Bloco para scripts específicos da página, como gráficos do dashboard -->
{% block scripts %}
{% endblock %}

</body>
</html>
