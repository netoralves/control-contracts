{% load static %}

<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Alltech Contratos{% endblock %}</title>
    <link rel="icon" href="{% static 'img/logo_alltech_branco2.png' %}">

    <!-- Flowbite e Font Awesome -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">

    <!-- Configuração do Tailwind CSS -->
    <script>
        tailwind.config = {
            darkMode: 'class', // Habilita o dark mode baseado em classe
            theme: {
                extend: {
                    colors: {
                        primary: {"50":"#eff6ff","100":"#dbeafe","200":"#bfdbfe","300":"#93c5fd","400":"#60a5fa","500":"#3b82f6","600":"#2563eb","700":"#1d4ed8","800":"#1e40af","900":"#1e3a8a","950":"#172554"}
                    }
                }
            }
        }
    </script>

    <style>
        /* Estilos para transições suaves */
        #default-sidebar, main {
            transition: all 0.3s ease-in-out;
        }

        /* Quando a sidebar está minimizada */
        body.sidebar-minimized #default-sidebar {
            width: 80px; /* Largura apenas para os ícones */
        }

        body.sidebar-minimized main {
            margin-left: 80px;
        }

        body.sidebar-minimized .nav-text, 
        body.sidebar-minimized #logo-container span {
            display: none; /* Esconde o texto dos links e da logo */
        }

        body.sidebar-minimized #logo-container {
            justify-content: center;
        }

        body.sidebar-minimized #default-sidebar ul a {
            justify-content: center; /* Centraliza os ícones */
        }
    </style>

    <script>
        // Script para aplicar tema escuro/claro imediatamente para evitar "flash" e persistir mudança
        if (localStorage.getItem('color-theme') === 'dark' || (!('color-theme' in localStorage) && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
            document.documentElement.classList.add('dark');
        } else {
            document.documentElement.classList.remove('dark');
        }
    </script>

</head>
<body class="bg-gray-100 dark:bg-gray-900">

<!-- Botão Hamburguer (agora fora do sidebar para controle) -->
<button id="hamburger-button" type="button" class="fixed top-4 z-50 left-4 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-white focus:outline-none">
    <svg class="w-10 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
</button>

<!-- Sidebar -->
<aside id="default-sidebar" class="fixed top-0 left-0 z-40 w-64 h-screen bg-white dark:bg-gray-800 shadow-lg">
    <div class="h-full px-3 py-4 overflow-y-auto">
        <!-- Logo -->
        <div id="logo-container" class="flex items-center ps-2.5 mb-5 h-12">
            <img src="{% static 'img/logo_alltech_branco2.png' %}" class="h-7 me-3" alt="Alltech Logo" />
            <span class="self-center text-xl font-semibold text-gray-500 whitespace-nowrap dark:text-white">AllTech</span>
        </div>

        <ul class="space-y-2 font-medium">
            <!-- Itens de Navegação -->
            <li>
                <a href="{% url 'dashboard' %}" class="flex items-center p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group">
                    <i class="fas fa-tachometer-alt fa-fw text-gray-500 dark:text-gray-400"></i>
                    <span class="ms-3 nav-text">Dashboard</span>
                </a>
            </li>
            <li>
                <a href="{% url 'cliente_list' %}" class="flex items-center p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group">
                    <i class="fas fa-users fa-fw text-gray-500 dark:text-gray-400"></i>
                    <span class="ms-3 nav-text">Clientes</span>
                </a>
            </li>
            <li>
                <a href="{% url 'contrato_list' %}" class="flex items-center p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group">
                    <i class="fas fa-file-contract fa-fw text-gray-500 dark:text-gray-400"></i>
                    <span class="ms-3 nav-text">Contratos</span>
                </a>
            </li>
            <li>
                <a href="{% url 'item_contrato_list' %}" class="flex items-center p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group">
                    <i class="fas fa-tasks fa-fw text-gray-500 dark:text-gray-400"></i>
                    <span class="ms-3 nav-text">Itens de Contrato</span>
                </a>
            </li>
            <li>
                <a href="{% url 'item_fornecedor_list' %}" class="flex items-center p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group">
                    <i class="fas fa-box-open fa-fw text-gray-500 dark:text-gray-400"></i>
                    <span class="ms-3 nav-text">Itens de Fornecedor</span>
                </a>
            </li>
            <li>
                <a href="{% url 'ordem_servico_list' %}" class="flex items-center p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group">
                    <i class="fas fa-tools fa-fw text-gray-500 dark:text-gray-400"></i>
                    <span class="ms-3 nav-text">Ordens de Serviço</span>
                </a>
            </li>
            <li>
                <a href="{% url 'ordem_fornecimento_list' %}" class="flex items-center p-2 text-gray-900 rounded-lg dark:text-white hover:bg-gray-100 dark:hover:bg-gray-700 group">
                    <i class="fas fa-truck-loading fa-fw text-gray-500 dark:text-gray-400"></i>
                    <span class="ms-3 nav-text">Ordens de Fornecimento</span>
                </a>
            </li>
        </ul>
    </div>
</aside>

<!-- Conteúdo Principal -->
<main id="main-content" class="p-4 ml-64">
    <div class="mt-14"> <!-- Margem no topo para não ficar atrás dos botões fixos -->
        {% block content %}
        <!-- O conteúdo específico de cada página será inserido aqui -->
        {% endblock %}
    </div>
</main>

<!-- Botões de Ação no Canto Superior Direito -->
<div class="fixed top-4 right-4 z-50 flex items-center space-x-4">

    <!-- Botão Dark/Light Mode -->
    <button id="theme-toggle" type="button" class="text-gray-500 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 focus:outline-none focus:ring-4 focus:ring-gray-200 dark:focus:ring-gray-700 rounded-lg text-sm p-2.5 me-4">
        <i id="theme-toggle-dark-icon" class="hidden fa-solid fa-moon fa-lg"></i>
        <i id="theme-toggle-light-icon" class="hidden fa-solid fa-sun fa-lg"></i>
    </button>

    <!-- Menu do Usuário -->
    <div>
        <button type="button" class="flex text-sm bg-gray-800 rounded-full focus:ring-4 focus:ring-gray-300 dark:focus:ring-gray-600" id="user-menu-button" aria-expanded="false" data-dropdown-toggle="user-dropdown" data-dropdown-placement="bottom">
            <span class="sr-only">Open user menu</span>
            <img class="w-8 h-8 rounded-full" src="https://ui-avatars.com/api/?name={{ user.get_full_name|default:'User' }}&background=0D8ABC&color=fff" alt="user photo">
         </button>
        <!-- Dropdown menu -->
        <div class="z-50 hidden my-4 text-base list-none bg-white divide-y divide-gray-100 rounded-lg shadow dark:bg-gray-700 dark:divide-gray-600" id="user-dropdown">
            <div class="px-4 py-3">
                <span class="block text-sm text-gray-900 dark:text-white">{{ user.get_full_name|default:'Usuário' }}</span>
                <span class="block text-sm text-gray-500 truncate dark:text-gray-400">{{ user.email|default:'email@example.com' }}</span>
            </div>
            <ul class="py-2" aria-labelledby="user-menu-button">
                <li>
                    <a href="#" id="logout-btn" class="block px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 dark:hover:bg-gray-600 dark:text-gray-200 dark:hover:text-white">Sair</a>
                </li>
            </ul>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.3.0/flowbite.min.js"></script>

<script>
document.addEventListener('DOMContentLoaded', function() {
    
    // --- LÓGICA DO TEMA (LIGHT/DARK MODE) ---
    const themeToggleButton = document.getElementById('theme-toggle');
    const themeToggleDarkIcon = document.getElementById('theme-toggle-dark-icon');
    const themeToggleLightIcon = document.getElementById('theme-toggle-light-icon');

    // Função para atualizar os ícones de tema
    function updateThemeIcons() {
        if (document.documentElement.classList.contains('dark')) {
            themeToggleLightIcon.classList.remove('hidden');
            themeToggleDarkIcon.classList.add('hidden');
        } else {
            themeToggleLightIcon.classList.add('hidden');
            themeToggleDarkIcon.classList.remove('hidden');
        }
    }
    // Inicializa os ícones no carregamento da página
    updateThemeIcons();

    // Lógica do Toggle de Tema (Dark/Light)
    themeToggleButton.addEventListener('click', () => {
        const isDark = document.documentElement.classList.toggle('dark');
        localStorage.setItem('color-theme', isDark ? 'dark' : 'light');
        updateThemeIcons();
    });

    // --- LÓGICA DO LOGOUT ---
    const logoutBtn = document.getElementById('logout-btn');
    if (logoutBtn) {
        logoutBtn.addEventListener('click', function(e) {
            e.preventDefault();
            // Idealmente, aqui você faria um POST para uma URL de logout
            // Para simplicidade, estamos apenas redirecionando.
            alert('Você será deslogado.');
            window.location.href = '/logout/'; // Adapte esta URL se necessário
        });
    }

    // --- LÓGICA DA SIDEBAR (MINIMIZAR/MAXIMIZAR) ---
    const hamburgerButton = document.getElementById('hamburger-button');
    const body = document.body;
    const mainContent = document.getElementById('main-content');
    const sidebar = document.getElementById('default-sidebar');

    // Função para aplicar o estado salvo da sidebar
    function applySidebarState() {
        if (localStorage.getItem('sidebarState') === 'minimized') {
            body.classList.add('sidebar-minimized');
            mainContent.style.marginLeft = '80px';
            hamburgerButton.style.left = '80px'; 
        } else {
            body.classList.remove('sidebar-minimized');
            mainContent.style.marginLeft = '256px'; // w-64
            hamburgerButton.style.left = '256px';
        }
    }

    // Aplica o estado ao carregar a página
    applySidebarState();
    // Move o botão hamburguer para a posição correta, que depende do estado da sidebar
    // A posição do botão hamburguer é relativa a sidebar
    hamburgerButton.style.left = body.classList.contains('sidebar-minimized') ? '80px' : '256px';

    hamburgerButton.addEventListener('click', function() {
        body.classList.toggle('sidebar-minimized');
        
        // Salva o novo estado no localStorage
        if (body.classList.contains('sidebar-minimized')) {
            localStorage.setItem('sidebarState', 'minimized');
        } else {
            localStorage.setItem('sidebarState', 'expanded');
        }
        
        // Reaplica o estado para ajustar margens e posições
        applySidebarState();
    });
});
</script>


<!-- Bloco para scripts específicos da página, como gráficos do dashboard -->
{% block scripts %}
{% endblock %}

</body>
</html>
